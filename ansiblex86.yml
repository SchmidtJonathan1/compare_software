###### Not finished WIP ######

## Install windows software with ansible x86
# ./roles/test/vars/vars.yml
---
apps:
  - softwareName: KeePass
    softwareVersion: "2.49"
    softwareParam: /VERYSILENT
    folderPath: C:\tmp
  - softwareName: Firefox
    softwareVersion: "92.0"
    softwareParam: /qn
    folderPath: c:\tmp\
  - softwareName: draw.io
    softwareVersion: "15.2.7"
    softwareParam: /SILENT
    folderPath: c:\tmp\

# ./roles/test/tasks/base.yml
---
## Include vars from role path
- name: includ vars
  include_vars: vars.yml

## Get all PSChildName names from registry
- name: reg displayname x86
  ansible.windows.win_shell: (Get-ItemProperty -Path HKLM:\SOFTWARE\WOW6432Node\Microsoft\Windows\CurrentVersion\Uninstall\*).PSChildName
  register: checkNamex86

## Loop registry with pschildnames
- name: reg x86 software path
  ansible.windows.win_reg_stat: 
    path: HKLM:\SOFTWARE\WOW6432Node\Microsoft\Windows\CurrentVersion\Uninstall\{{ item }}
  loop: "{{ checkNamex86.stdout_lines }}"
  register: checkVerx86

## Set facts for name and version
- name: set facts x86 displayName and displayVersion
  set_fact:
    regListx86: "{{ regListx86| default ([]) + [item.properties.DisplayName.value + ' ' + item.properties.DisplayVersion.value] }}"
  when: item.properties.DisplayName.value is defined
  loop: "{{ checkVerx86.results }} "

## Install software
- name: Install software x86
  debug:
    msg: "Test x86"
#  ansible.windows.win_package:
#    path: C:\tmp\KeePass-2.49-Setup.exe
#    product_id: KeePassPasswordSafe2_is1
#    arguments: /VERYSILENT
#    creates_path: "C:\\Program Files\\KeePass Password Safe 2\\KeePass.exe"
#    creates_version: "2.49"
#    state: present
  when:
    - regListx86 | regex_search(item.softwareName)
    - not regListx86 | regex_search(item.softwareVersion)
  loop: "{{ apps }}"
...
